$(document).on("pagebeforeshow","#location",function(){function i(e){$.ajax({url:"json/stop.json",type:"GET",dataType:"json",success:function(t){for(var n=0;n<t.length;n++){if(n==t.length-1){r.finish=new google.maps.LatLng(t[n].lat,t[n].lng)}else{r.addStop({location:new google.maps.LatLng(t[n].lat,t[n].lng),stopover:true})}}s(new google.maps.LatLng(e.coords.latitude,e.coords.longitude))},error:function(){alert("Error")}})}function s(e){r.start=e;var t={zoom:8,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP};var n=new google.maps.Map(document.getElementById("map_canvas"),t);var i=new google.maps.Marker({position:e,map:n,title:"You are here."});var s=new google.maps.DirectionsService;var o=new google.maps.DirectionsRenderer;o.setMap(n);var u={origin:r.start,destination:r.finish,waypoints:r.stops,optimizeWaypoints:true,travelMode:google.maps.DirectionsTravelMode.DRIVING};s.route(u,function(e,t){if(t==google.maps.DirectionsStatus.OK){o.setDirections(e)}})}if(navigator.geolocation){function e(e){if(localStorage){if(localStorage.getItem("username")==null){alert("You must be signed in to view the route");window.location.assign("index.html")}else{i(e)}}else{i(e)}}function t(e){alert("Geolocation failed.")}function n(e){if(err.code==0){alert("unknown")}if(err.code==1){alert("permission denied")}else if(err.code==2){alert("position unavailable")}else if(err.code==3){alert("timeout.")}}navigator.geolocation.getCurrentPosition(e,t)}else{alert("There was a problem.")}var r=new Route});$(document).on("pagecreate","#location",function(){if(localStorage){var e=localStorage.getItem("fS");var t=localStorage.getItem("username");if(t!==null&&t!==""&&t!=="undefined"){$("#curUser").text("Signed in as: "+t)}else $("#signOut").html("Sign in")}$("#signOut").on("click",function(e){e.preventDefault();e.stopPropagation();var t=localStorage.getItem("username");if(t===null||t===""){window.location.assign("index.html")}else{localStorage.removeItem("username");location.reload()}})})